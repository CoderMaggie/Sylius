{% set taxAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::TAX_ADJUSTMENT') %}
{% set shippingAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::SHIPPING_ADJUSTMENT') %}
{% set orderPromotionAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::ORDER_PROMOTION_ADJUSTMENT') %}
{% set orderItemPromotionAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::ORDER_ITEM_PROMOTION_ADJUSTMENT') %}

<div class="table-responsive">
    <table class="table" id="order-review">
        <thead>
            <tr>
                <th colspan="3">Product</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th colspan="2">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order.items %}
                {% include 'SyliusWebBundle:Frontend/Checkout/Step/Finalize:_item.html.twig' %}
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <th colspan="5">Total</th>
                {% set total = order.itemsTotal - order.getAdjustmentsTotalRecursively(taxAdjustment) - order.getAdjustmentsTotalRecursively(orderItemPromotionAdjustment) %}
                <th colspan="2">{{ (total)|sylius_price }}</th>
            </tr>
            <tr>
                <th colspan="5">Shipping cost</th>
                <th colspan="2">
                    {% set shippingTotal = order.adjustmentsTotal(taxAdjustment) + order.adjustmentsTotal(shippingAdjustment) %}
                    {{ shippingTotal|sylius_price }}
                </th>
            </tr>
            <tr>
                <th colspan="5">Tax</th>
                <th colspan="2">{{ order.getAdjustmentsTotalRecursively(taxAdjustment)|sylius_price }}</th>
            </tr>
            <tr>
                <th colspan="5">Discount</th>
                {% set discountAmount = order.adjustmentsTotalRecursively(orderItemPromotionAdjustment) + order.adjustmentsTotalRecursively(orderPromotionAdjustment) %}
                <th colspan="2">{{ (-1 * discountAmount)|sylius_price }}</th>
            </tr>
            {% if order.promotionCoupon is not null %}
                <tr>
                    <th colspan="5">Coupon</th>
                    <th colspan="2">{{ order.promotionCoupon.code }}</th>
                </tr>
            {% endif %}
            <tr class="total">
                <th colspan="5">Grand total</th>
                <th>{{ order.total|sylius_price }}</th>
            </tr>
        </tfoot>
    </table>
</div>

<div class="row text-center">
    {% if not order.lastShipment == null %}
        <div class="col-md-6">
            <div class="box">
                <h4>Shipping method</h4>
                <p>{{ order.lastShipment.method.name }}</p>
            </div>
        </div>
    {% endif %}
    {% if order.lastPayment %}
        <div class="col-md-6">
            <div class="box">
                <h4>Payment method</h4>
                <p>{{ order.lastPayment.method.name }}</p>
            </div>
        </div>
    {% endif %}
</div>
