{% set taxAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::TAX_ADJUSTMENT') %}
{% set shippingAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::SHIPPING_ADJUSTMENT') %}
{% set promotionAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::PROMOTION_ADJUSTMENT') %}

<div class="table-responsive">
    <table class="table" id="order-review">
        <thead>
            <tr>
                <th colspan="3">Product</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th colspan="2">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order.items %}
                {% include 'SyliusWebBundle:Frontend/Checkout/Step/Finalize:_item.html.twig' %}
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <th colspan="5">Total</th>
                <th colspan="2">{{ order.itemsTotal|sylius_price }}</th>
            </tr>
            <tr>
                <th colspan="2">Shipping method</th>
                {% if not order.lastShipment == null %}
                    <th colspan="3">{{ order.lastShipment.method.name }}</th>
                {% else %}
                    <th colspan="3"></th>
                {% endif %}
                <th colspan="2">
                    {% set shippingTotal = order.adjustmentsTotal(taxAdjustment) + order.adjustmentsTotal(shippingAdjustment) %}
                    {{ shippingTotal|sylius_price }}
                </th>
            </tr>
            {% if not order.lastPayment == null %}
                <tr>
                    <th colspan="2">Payment method</th>
                    <th colspan="3">{{ order.lastPayment.method.name }}</th>
                    <th colspan="2">{{ order.lastPayment.method.amount|sylius_price }}</th>
                </tr>
            {% endif %}
            <tr>
                <th colspan="5">Tax</th>
                <th colspan="2">{{ order.getAdjustmentsTotalRecursively(taxAdjustment)|sylius_price }}</th>
            </tr>
            <tr>
                <th colspan="5">Discount</th>
                <th colspan="2">{{ (-1 * order.adjustmentsTotalRecursively(promotionAdjustment))|sylius_price }}</th>
            </tr>
            {% if order.promotionCoupon is not null %}
                <tr>
                    <th colspan="5">Coupon</th>
                    <th colspan="2">order.promotionCoupon.code</th>
                </tr>
            {% endif %}
            <tr class="total">
                <th colspan="5">Grand total</th>
                <th>{{ order.total|sylius_price }}</th>
            </tr>
        </tfoot>
    </table>
</div>
