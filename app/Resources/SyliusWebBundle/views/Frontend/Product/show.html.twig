{% extends '@SyliusWeb/Frontend/layout.html.twig' %}
{% import '@SyliusWeb/Frontend/Product/macros.html.twig' as macro %}

{% set form = sylius_cart_form({'product': product}) %}

{% block javascripts %}
    {{ parent() }}
    {% javascripts output='assets/compiled/backend_review.js'
    'bundles/syliusreview/js/sylius-review.js' %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    <script>
        var createMessage = "{{ 'sylius.resource.create'|trans({'%resource%': 'Product review'}, 'flashes') }}";
        $(document).ready(function () {
            initializeAjaxForm(createMessage);
        });
    </script>
    {% endjavascripts %}
{% endblock %}

{% block title %}
    - {{ product.name }}
{% endblock %}

{% block topbar %}
    <ul class="breadcrumb">
        <li><a href={{ path('sylius_homepage') }}>Home</a></li>
        {% for taxon in product.taxons %}
            <li><a href={{ path(taxon.permalink) }}>{{ taxon.name }}</a></li>
        {% endfor %}
        <li>{{ product.name }}</li>
    </ul>
{% endblock %}

{% block content %}
    <div class="box text-center">
        <div class="row">
            <div class="col-sm-10 col-sm-offset-1">
                <h1>{{ product.name }}</h1>

                <p class="goToDescription"><a href="#details" class="scroll-to">Jump to details</a></p>
            </div>
        </div>
    </div>

    {{ parent() }}

    <div class="col-md-9">
        <div class="row" id="productMain">
            <div class="col-sm-6">
                <div id="mainImage">
                    <img class="img-responsive"
                         src="{{ product.image ? product.image.path|imagine_filter('sylius_large') : 'http://placehold.it/262x255' }}"
                         alt="{{ product.name }}">
                </div>
                {{ macro.all_ribbons('plain_ribbon', product) }}
            </div>

            <div class="col-sm-6">
            <div class="box">
                    <form action="{{ path('sylius_cart_item_add', {'id': product.id}) }}" method="post" class="clearfix">
                        <div class="row">
                            <div class="col-md-12">
                                {% if product.hasVariants %}
                                    {% if product.isVariantSelectionMethodChoice %}
                                        <table class="table" id="product-variants">
                                            <thead>
                                            <tr>
                                                <th></th>
                                                <th class="text-center">Price</th>
                                                <th></th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for variant in product.variants if variant.available %}
                                                <tr>
                                                    <td>
                                                        {% if variant.presentation is empty %}
                                                            <ul style="list-style-type: none;">
                                                                {% for option in variant.options %}
                                                                    <li>
                                                                        <h4>{{ option.presentation }}: <div class="text-muted">{{ option.value }}</div></h4>
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                        {% else %}
                                                            <h4>{{ variant.presentation }}</h4>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        {{ macro.sylius_display_price(variant) }}
                                                    </td>
                                                    <td>
                                                        <h3>
                                                        {% if sylius_inventory_is_available(variant) %}
                                                            {{ form_widget(form.variant[loop.index0]) }}
                                                        {% else %}
                                                            <span class="label label-warning">Out of stock</span>
                                                        {% endif %}
                                                        </h3>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    {% else %}
                                        <div>&nbsp;</div>
                                        {% for variant in form.variant.children %}
                                            <p>
                                                {{ form_label(variant, null, {'label_attr': {'class': 'text-left'}}) }}
                                                {{ form_widget(variant) }}
                                                {{ form_errors(variant) }}
                                            </p>
                                        {% endfor %}
                                    {% endif %}
                                {% else %}
                                    <h4 class="text-muted">
                                        <span class="pull-right">
                                           {{ macro.sylius_display_price(product.masterVariant) }}
                                        </span>
                                    </h4>
                                {% endif %}
                                {% if not product.hasVariants and not sylius_inventory_is_available(product.masterVariant) %}
                                    <h2 class="text-center" style="color: maroon">Out of stock</h2>
                                {% else %}
                                    <p>
                                        {{ form_label(form.quantity, null, {'label_attr': {'class': 'text-center'}}) }}
                                        {{ form_widget(form.quantity) }}
                                        {{ form_errors(form.quantity) }}
                                    </p>
                                    <div class="hidden">
                                        {{ form_rest(form) }}
                                    </div>
                                    <p class="text-center">

                                    {% if sylius_is_restricted(product) %}
                                        <button disabled="disabled" class="btn btn-default btn-lg">
                                            <i class="fa fa-cart-plus"></i>
                                            We are sorry. This product is not available in your country.
                                        </button>
                                    {% else %}
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fa fa-cart-plus"></i>
                                            Add to cart
                                        </button>
                                    {% endif %}
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    </form>
                </div>
                <div class="row" id="thumbs">
                    {% for image in product.images %}
                        <div class="col-xs-4">
                            <a href="{{ image.path|imagine_filter('sylius_large') }}" title="{{ product.name }}" class="thumb">
                                <img class="img-responsive" src="{{ image.path|imagine_filter('sylius_small') }}" alt="{{ product.name }}">
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="box" id="details">
            <h4>Product details</h4>
            <p>{{ product.description|default('sylius.product.no_description')|trans|raw }}</p>
            {% if product.attributes|length > 0 %}
                <table class="table">
                    <thead>
                        <tr>
                            <th colspan="2"><h4>Attributes</h4></th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for attribute in product.attributes %}
                        <tr>
                            <td><p>{{ attribute.name }}</p></td>
                            {% set attributeTemplate = 'SyliusAttributeBundle:Types:' ~ attribute.attribute.type ~ '.html.twig' %}
                            {% include [attributeTemplate, 'SyliusWebBundle:Frontend/Product:_attribute.html.twig'] with {'attribute': attribute} %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>

        {{ macro.render_reviews(product) }}

    </div>

    <div class="col-md-3">
        {% include '@SyliusWeb/Frontend/Product/menu.html.twig' %}
    </div>

{% endblock %}
