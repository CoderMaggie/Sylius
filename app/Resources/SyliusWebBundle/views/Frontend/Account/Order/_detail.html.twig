{% set taxAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::TAX_ADJUSTMENT') %}
{% set shippingAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::SHIPPING_ADJUSTMENT') %}
{% set promotionAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::PROMOTION_ADJUSTMENT') %}

<div class="table-responsive">
    <table id="items" class="table">
        <thead>
            <tr>
                <th colspan="3">{{ 'sylius.order_item.sellable'|trans }}</th>
                <th>{{ 'sylius.order_item.quantity'|trans }}</th>
                <th>{{ 'sylius.order_item.unit_price'|trans }}</th>
                <th colspan="2">{{ 'sylius.order_item.total'|trans }}</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order.items %}
                {% set product = item.product %}
                <tr>
                    <th colspan="3">
                        {{ include('@SyliusWeb/Frontend/Product/_variant.html.twig', {'variant': item.variant}) }}
                    </th>
                    <th>{{ item.quantity }}</th>
                    <th>{{ item.unitPrice|sylius_money(order.currency) }}</th>
                    <th colspan="2">{{ item.total|sylius_money(order.currency) }}</th>
                </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <th colspan="5">Total</th>
                <th colspan="2">{{ order.itemsTotal|sylius_money(order.currency) }}</th>
            </tr>
            <tr>
                <th colspan="5">Shipping cost</th>
                <th colspan="2">
                    {% set shippingTotal = order.adjustmentsTotal(taxAdjustment) + order.adjustmentsTotal(shippingAdjustment) %}
                    {{ shippingTotal|sylius_money(order.currency) }}
                </th>
            </tr>
            <tr>
                <th colspan="5">Tax</th>
                <th colspan="2">
                    {{ order.getAdjustmentsTotalRecursively(taxAdjustment)|sylius_money(order.currency) }}
                </th>
            </tr>
            <tr>
                <th colspan="5">Discount</th>
                <th colspan="2">
                    {{ (-1 * order.adjustmentsTotalRecursively(promotionAdjustment))|sylius_money(order.currency) }}
                </th>
            </tr>
            {% if order.promotionCoupon is not null %}
                <tr>
                    <th colspan="4">Coupon</th>
                    <th colspan="3">order.promotionCoupon.code</th>
                </tr>
            {% endif %}
            <tr>
                <th colspan="7"></th>
            </tr>
            <tr>
                <th colspan="5">Grand total</th>
                <th colspan="2">{{ order.total|sylius_money(order.currency) }}</th>
            </tr>
            <tr>
                <th colspan="7"></th>
            </tr>
            <tr>
                {% if order.lastPayment %}
                    <th colspan="5">Payment</th>
                    <th colspan="2">{{ order.lastPayment.amount|sylius_money(order.currency) }}</th>
                {% endif %}
            </tr>
        </tfoot>
    </table>
</div>

<div class="row text-center">
    <div class="col-md-6">
        <div class="box">
            <h4>Shipping method</h4>
            <p>{{ order.lastShipment.method.name }}</p>
        </div>
    </div>
    {% if order.lastPayment %}
        <div class="col-md-6">
            <div class="box">
                <h4>Payment method</h4>
                <p>{{ order.lastPayment.method.name }}</p>
            </div>
        </div>
    {% elseif order.isInvoiceAvailable %}
        <div class="col-md-6">
            <div class="box">
                {{ buttons.btn(
                    path('sylius_account_order_invoice', {'number': order.number}),
                    'Download invoice',
                    'order-' ~ order.number ~ '-invoice',
                    'file-text',
                    'btn btn-primary btn-lg'
                ) }}
            </div>
        </div>
    {% endif %}
</div>

<div class="row addresses text-right">
    <div class="col-md-6">
        <div class="box">
            <h3>{{ 'sylius.checkout.finalize.order.shipping_address'|trans }}</h3>
            {% include 'SyliusWebBundle:Common/Address:_show.html.twig' with { 'address': order.shippingAddress } %}
        </div>
    </div>
    <div class="col-md-6">
        <div class="box">
            <h3>{{ 'sylius.checkout.finalize.order.billing_address'|trans }}</h3>
            {% include 'SyliusWebBundle:Common/Address:_show.html.twig' with { 'address': order.billingAddress } %}
        </div>
    </div>
</div>
