{% set taxAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::TAX_ADJUSTMENT') %}
{% set shippingAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::SHIPPING_ADJUSTMENT') %}
{% set orderPromotionAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::ORDER_PROMOTION_ADJUSTMENT') %}
{% set orderItemPromotionAdjustment = constant('Sylius\\Component\\Core\\Model\\AdjustmentInterface::ORDER_ITEM_PROMOTION_ADJUSTMENT') %}

<div class="table-responsive">
    <table id="items" class="table">
        <thead>
            <tr>
                <th colspan="3">{{ 'sylius.order_item.sellable'|trans }}</th>
                <th>{{ 'sylius.order_item.quantity'|trans }}</th>
                <th>{{ 'sylius.ui.unit_price'|trans }}</th>
                <th colspan="2">{{ 'sylius.ui.total'|trans }}</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order.items %}
                {% set product = item.product %}
                <tr>
                    <th colspan="3">
                        {{ include('@SyliusWeb/Frontend/Product/_variant.html.twig', {'variant': item.variant}) }}
                    </th>
                    <th>{{ item.quantity }}</th>
                    <th>
                        {% if item.unitPrice != item.discountedUnitPrice %}
                            <s>{{ item.unitPrice|sylius_price }}</s>
                            {{ item.discountedUnitPrice|sylius_price }}
                        {% else %}
                            {{ item.unitPrice|sylius_price(order.currency) }}
                        {% endif %}
                    </th>
                    <th colspan="2">{{ item.subtotal|sylius_price(order.currency) }}</th>
                </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <th colspan="5">{{ 'app.ui.order_subtotal'|trans }}</th>
                <th colspan="2">{{ order.subtotal|sylius_price(order.currency) }}</th>
            </tr>
            <tr>
                <th colspan="5">{{ 'app.ui.shipping_fee'|trans }}</th>
                <th colspan="2">{{ order.shippingTotal|sylius_price(order.currency) }}</th>
            </tr>
            <tr>
                <th colspan="5">{{ 'app.ui.tax'|trans }}</th>
                <th colspan="2">{{ order.taxTotal|sylius_price(order.currency) }}</th>
            </tr>
            <tr>
                <th colspan="5">{{ 'app.ui.discount'|trans }}</th>
                <th colspan="2">{{ (-1 * order.orderPromotionTotal)|sylius_price(order.currency) }}</th>
            </tr>
            {% if order.promotionCoupon is not null %}
                <tr>
                    <th colspan="4">{{ 'sylius.ui.coupon'|trans }}</th>
                    <th colspan="3">{{ order.promotionCoupon.code }}</th>
                </tr>
            {% endif %}
            <tr>
                <th colspan="7"></th>
            </tr>
            <tr>
                <th colspan="5">{{ 'sylius.ui.grand_total'|trans }}</th>
                <th colspan="2">{{ order.total|sylius_price(order.currency) }}</th>
            </tr>
        </tfoot>
    </table>
</div>

<div class="row text-center">
    <div class="col-md-6">
        <div class="box">
            <h4>{{ 'sylius.ui.shipping_method'|trans }}</h4>
            <p>{{ order.lastShipment.method.name }}</p>
        </div>
    </div>
    {% if order.isInvoiceAvailable %}
        <div class="col-md-6">
            <div class="box">
                {{ buttons.btn(
                path('sylius_account_order_invoice', {'number': order.number}),
                'Download invoice',
                'order-' ~ order.number ~ '-invoice',
                'file-text',
                'btn btn-primary btn-lg'
                ) }}
            </div>
        </div>
    {% elseif order.payments|last %}
        <div class="col-md-6">
            <div class="box">
                <h4>{{ 'sylius.ui.payment_method'|trans }}</h4>
                <p>{{ (order.payments|last).method.name }}</p>
                {% if order.lastPayment %}
                    {{ buttons.btn(
                    path('sylius_order_payment_index', {'number': order.number}),
                    'app.ui.pay',
                    'order-' ~ order.number ~ '-payments',
                    'money',
                    'btn btn-primary'
                    ) }}
                {% endif %}

            </div>
        </div>
        {% if 'new' == order.payments.last.state %}
            <div class="col-md-12">
                <div class="box">
                    <h5>{{ 'app.ui.payment_instructions'|trans }}</h5>
                    {{ order.payments.last.method.paymentInstructions }}
                </div>
            </div>
        {% endif %}
    {% endif %}
</div>

<div class="row addresses text-right">
    <div class="col-md-6">
        <div class="box">
            <h3>{{ 'sylius.ui.shipping_address'|trans }}</h3>
            {% include 'SyliusWebBundle:Common/Address:_show.html.twig' with { 'address': order.shippingAddress } %}
        </div>
    </div>
    <div class="col-md-6">
        <div class="box">
            <h3>{{ 'sylius.ui.billing_address'|trans }}</h3>
            {% include 'SyliusWebBundle:Common/Address:_show.html.twig' with { 'address': order.billingAddress } %}
        </div>
    </div>
</div>
